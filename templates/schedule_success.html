{% extends "base.html" %}

{% block title %}æ’ç¨‹å®Œæˆ - {{ config.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- æˆåŠŸæ ‡é¢˜åŒºåŸŸ -->
    <div class="text-center mb-5">
        <div class="success-icon mb-3">
            <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
        </div>
        <h1 class="display-4 text-success mb-2">ğŸ‰ æ’ç¨‹å®Œæˆï¼</h1>
        <p class="lead text-muted">ä»»åŠ¡æ—¥ç¨‹å·²æˆåŠŸå®‰æ’å¹¶åŒæ­¥åˆ° Notion</p>
    </div>

    <!-- ç»“æœç»Ÿè®¡å¡ç‰‡ -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-bar me-2"></i>æ’ç¨‹ç»“æœç»Ÿè®¡
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <div class="statistic-item">
                                <h2 class="text-success mb-1">{{ result.success_count }}</h2>
                                <p class="text-muted mb-0">æˆåŠŸæ’ç¨‹</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="statistic-item">
                                <h2 class="text-info mb-1">{{ result.total_count }}</h2>
                                <p class="text-muted mb-0">æ€»ä»»åŠ¡æ•°</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="statistic-item">
                                {% set success_rate = (result.success_count / result.total_count * 100) | round(1) if result.total_count > 0 else 0 %}
                                <h2 class="{% if success_rate == 100 %}text-success{% elif success_rate > 50 %}text-warning{% else %}text-danger{% endif %} mb-1">
                                    {{ success_rate }}%
                                </h2>
                                <p class="text-muted mb-0">æˆåŠŸç‡</p>
                            </div>
                        </div>
                    </div>

                    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                    <hr>
                    <div class="text-center">
                        {% if result.status == 'completed' %}
                            <span class="badge bg-success fs-6 p-2">
                                <i class="fas fa-check me-1"></i>å®Œå…¨æˆåŠŸ
                            </span>
                        {% elif result.status == 'partial' %}
                            <span class="badge bg-warning fs-6 p-2">
                                <i class="fas fa-exclamation-triangle me-1"></i>éƒ¨åˆ†æˆåŠŸ
                            </span>
                        {% else %}
                            <span class="badge bg-danger fs-6 p-2">
                                <i class="fas fa-times me-1"></i>æ‰§è¡Œå¤±è´¥
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—¶é—´ä¿¡æ¯å¡ç‰‡ -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-clock me-2"></i>æ—¶é—´ä¿¡æ¯
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="time-info">
                                <label class="form-label text-muted">æ’ç¨‹å¼€å§‹æ—¶é—´</label>
                                <div class="time-display">
                                    <i class="fas fa-play text-success me-2"></i>
                                    <span id="start-time">{{ result.start_time.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="time-info">
                                <label class="form-label text-muted">æ“ä½œå®Œæˆæ—¶é—´</label>
                                <div class="time-display">
                                    <i class="fas fa-flag-checkered text-primary me-2"></i>
                                    <span id="completion-time">{{ result.completion_time.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M:%S') }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ“ä½œä¿¡æ¯ -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h6 class="card-title text-muted mb-1">æ“ä½œè®°å½• ID</h6>
                            <code class="fs-6">#{{ result.operation_id }}</code>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-database text-muted"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <a href="{{ url_for('schedule') }}" class="btn btn-primary btn-lg me-md-2">
                    <i class="fas fa-calendar-plus me-2"></i>å†æ¬¡æ’ç¨‹
                </a>
                <a href="{{ url_for('schedule_history') }}" class="btn btn-outline-secondary btn-lg me-md-2">
                    <i class="fas fa-history me-2"></i>æŸ¥çœ‹å†å²
                </a>
                <a href="{{ url_for('index') }}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-home me-2"></i>è¿”å›é¦–é¡µ
                </a>
            </div>
        </div>
    </div>

    <!-- æ¸©é¦¨æç¤º -->
    <div class="row justify-content-center mt-5">
        <div class="col-md-8">
            <div class="alert alert-info">
                <i class="fas fa-lightbulb me-2"></i>
                <strong>æ¸©é¦¨æç¤ºï¼š</strong>
                ä½ çš„ä»»åŠ¡æ—¶é—´å·²ç»åŒæ­¥åˆ° Notionï¼Œå¯ä»¥åœ¨ Notion ä¸­æŸ¥çœ‹è¯¦ç»†çš„æ—¥ç¨‹å®‰æ’ã€‚
                å¦‚æœéœ€è¦è°ƒæ•´ä»»åŠ¡æ—¶é—´ï¼Œè¯·ç›´æ¥åœ¨ Notion ä¸­ä¿®æ”¹æˆ–é‡æ–°è¿è¡Œæ’ç¨‹ã€‚
            </div>
        </div>
    </div>
</div>

<style>
.success-icon {
    animation: bounce 1s ease-in-out;
}

@keyframes bounce {
    0%, 20%, 60%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    80% {
        transform: translateY(-5px);
    }
}

.statistic-item {
    padding: 1rem 0;
    border-right: 1px solid #dee2e6;
}

.statistic-item:last-child {
    border-right: none;
}

.time-info {
    margin-bottom: 1rem;
}

.time-display {
    background-color: #f8f9fa;
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    border-left: 3px solid #007bff;
    font-weight: 500;
}

.card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .display-4 {
        font-size: 2rem;
    }
    
    .statistic-item {
        border-right: none;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 0.5rem;
        padding-bottom: 0.5rem;
    }
    
    .statistic-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
}
</style>

<script>
// é¡µé¢åŠ è½½å®Œæˆåçš„æ•ˆæœ
document.addEventListener('DOMContentLoaded', function() {
    // é¡µé¢æ•°æ®
    const resultData = {
        successCount: {{ result.success_count }},
        totalCount: {{ result.total_count }},
        status: '{{ result.status }}'
    };
    
    // å¯ä»¥æ·»åŠ æ•°å­—é€’å¢åŠ¨ç”»ç­‰æ•ˆæœ
    console.log('æ’ç¨‹å®Œæˆé¡µé¢åŠ è½½æˆåŠŸ', resultData);
    
    // å¦‚æœéœ€è¦è‡ªåŠ¨è·³è½¬ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Šä¸‹é¢çš„ä»£ç 
    // setTimeout(function() {
    //     window.location.href = "{{ url_for('schedule') }}";
    // }, 5000); // 5ç§’åè‡ªåŠ¨è·³è½¬
});
</script>
{% endblock %} 