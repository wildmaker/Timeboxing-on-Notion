# Notion自动化工具 - 启动脚本使用说明

## 🚀 快速开始

现在你可以通过以下脚本一键启动项目，无需手动激活虚拟环境和启动应用！

## 📁 脚本文件说明

### 基础脚本
- **`start.sh`** - 适用于 macOS/Linux 的基础启动脚本
- **`start.bat`** - 适用于 Windows 的基础启动脚本
- **`stop.sh`** - 适用于 macOS/Linux 的停止脚本

### 高级脚本
- **`start_advanced.sh`** - 智能启动脚本，包含更多高级功能

## 🎯 使用方法

### macOS/Linux 用户

#### 基础启动
```bash
# 方法1：直接运行
./start.sh

# 方法2：使用bash运行
bash start.sh
```

#### 高级启动（推荐）
```bash
# 智能启动，包含完整的环境检查和优化
./start_advanced.sh
```

#### 停止应用
```bash
# 停止应用并清理临时文件
./stop.sh
```

### Windows 用户

#### 启动应用
```cmd
# 双击运行 start.bat 文件
# 或在命令提示符中运行
start.bat
```

## ✨ 脚本功能特性

### 基础脚本功能
- ✅ 自动检查并创建虚拟环境
- ✅ 自动激活虚拟环境
- ✅ 自动安装/更新依赖包
- ✅ 自动执行数据库迁移
- ✅ 启动Flask应用
- ✅ 友好的彩色输出提示

### 高级脚本额外功能
- ✅ Python版本检查
- ✅ 端口占用检查和自动处理
- ✅ 智能依赖包管理（只在需要时安装）
- ✅ 自动创建示例.env文件
- ✅ 应用日志记录
- ✅ 数据库状态智能检查
- ✅ 完整的错误处理和清理机制

### 停止脚本功能
- ✅ 优雅关闭应用进程
- ✅ 强制终止顽固进程
- ✅ 清理临时文件和缓存
- ✅ 完整的状态检查

## 🔧 首次使用准备

### 1. 环境要求
- Python 3.7+ （推荐 3.8+）
- pip 包管理器
- 操作系统：macOS、Linux 或 Windows

### 2. 配置文件
脚本会自动创建示例 `.env` 文件，请根据实际情况修改：

```env
# Notion API配置
NOTION_API_TOKEN=your_notion_api_token_here

# 数据库配置
DATABASE_URL=sqlite:///instance/app.db

# Flask配置
FLASK_ENV=development
FLASK_DEBUG=True
SECRET_KEY=your_secret_key_here
```

### 3. 权限设置（macOS/Linux）
```bash
# 为脚本添加可执行权限
chmod +x start.sh
chmod +x start_advanced.sh
chmod +x stop.sh
```

## 🚨 故障排除

### 常见问题

#### 1. 权限不足
```bash
# 解决方案：添加可执行权限
chmod +x start.sh
```

#### 2. Python未找到
```bash
# 确保Python已安装并在PATH中
python3 --version
# 或
python --version
```

#### 3. 端口被占用
高级启动脚本会自动处理端口占用问题，或手动执行：
```bash
# 查找占用端口5001的进程
lsof -i :5001

# 终止进程
kill -9 <进程ID>
```

#### 4. 依赖安装失败
```bash
# 手动安装依赖
source venv/bin/activate
pip install -r requirements.txt
```

#### 5. 数据库迁移失败
```bash
# 手动执行数据库迁移
source venv/bin/activate
flask db upgrade
```

## 📝 脚本执行流程

### 基础启动流程
1. 检查虚拟环境，不存在则创建
2. 激活虚拟环境
3. 安装/更新依赖包
4. 检查配置文件
5. 执行数据库迁移
6. 启动Flask应用

### 高级启动流程
1. **环境检查**
   - Python版本验证
   - 端口占用检查
2. **环境准备**
   - 创建日志目录
   - 设置虚拟环境
   - 智能依赖管理
   - 配置文件检查
3. **数据库准备**
   - 智能数据库状态检查
   - 按需执行迁移
4. **启动应用**
   - 启动Flask应用
   - 记录日志文件

## 🎨 个性化配置

### 修改端口
编辑脚本中的 `APP_PORT` 变量：
```bash
APP_PORT=5001  # 修改为你想要的端口
```

### 修改应用名称
编辑脚本中的 `APP_NAME` 变量：
```bash
APP_NAME="你的应用名称"
```

### 日志配置
高级脚本会在 `logs/` 目录创建时间戳日志文件，格式：
```
logs/app_2024-01-01_10-30-15.log
```

## 🤝 技术支持

如果遇到问题，请检查：
1. Python环境是否正确安装
2. 脚本是否有可执行权限
3. 依赖包是否正确安装
4. 配置文件是否正确设置
5. 端口是否被其他程序占用

## 📦 备份与恢复

### 备份重要文件
```bash
# 备份数据库
cp instance/app.db instance/app.db.backup

# 备份配置文件
cp .env .env.backup
```

### 重置环境
```bash
# 删除虚拟环境（重新创建）
rm -rf venv

# 清理缓存
rm -rf __pycache__
find . -name "*.pyc" -delete
```

---

🎉 享受一键启动的便利！如果你有任何建议或问题，欢迎反馈。 